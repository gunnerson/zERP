{% extends "mtn/base.html" %}

{% load crispy_forms_tags %}

<script>
  {% block jquery %}

    $("#groupSelect, #subgroupSelect").change(function () {
      var endpoint = "{% url 'mtn:ajax_new_order' %}";
      var group = $("#groupSelect").val();
      var subgroup = $("#subgroupSelect").val();

      if(group != "PR" ){
        $("#subgroupField").hide();
      } else {
        $("#subgroupField").show();
      };

      $.ajax({
        url: endpoint,
        data: {
          'group': group,
          'subgroup': subgroup,
        },
        success: function (data) {
          $("#id_local").html(data);
        }
      });

    });

  {% endblock %}
</script>

{% block left-menu%}

  <ul>
    <li>
      <a href="" onClick="window.history.back();return false;" class="side-menu-link" role="button">Back</a>
    </li>
  </ul>

{% endblock left-menu %}

{% block page-title %}

  <div class="page-title-right">
    <ol class="breadcrumb m-0">
        <li class="breadcrumb-item"><a href="{% url 'mtn:index' %}">Rahco</a></li>
        <li class="breadcrumb-item"><a href="{% url 'mtn:order-list' %}">Work orders</a></li>
        <li class="breadcrumb-item active">New</li>
    </ol>
  </div>
  <h4 class="page-title">New order</h4>

{% endblock page-title %}

{% block content %}

  <form method='post' id="orderForm" novalidate>
    {% csrf_token %}
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm">
          {{ form.origin|as_crispy_field }}
        </div>
          <div class="form-group col align-self-end" id="groupField">
            <label class="requiredField" for="group_select">Group</label>
            <select class="form-control" name="group" id="groupSelect">
              <option value="PR">Production</option>
              <option value="GN">General</option>
              <option value="BD">Building</option>
              <option value="LF">Lifting equipment</option>
            </select>
          </div>
          <div class="form-group col align-self-end" id="subgroupField">
            <label class="requiredField" for="subgroup_select">Type</label>
            <select class="form-control" name="subgroup" id="subgroupSelect">
              <option value="">All</option>
              <option value="CN">Conventional</option>
              <option value="VC">Vacuum</option>
              <option value="IN">Injection</option>
              <option value="PN">Punching</option>
              <option value="OT">Other</option>
            </select>
          </div>
        <div class="col-sm">
          {{ form.local|as_crispy_field }}
        </div>
        <div class="col-sm">
          {{ form.ordertype|as_crispy_field }}
        </div>
      </div>
      {{ form.descr|as_crispy_field }}
    </div>
    <button name="submit" role="button" class="btn btn-rahco">Save order</button>
  </form>

{% endblock content %}
